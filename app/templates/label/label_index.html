{% extends '/extends/default_layout.html' %}

{% block body %}

<br>
<h1 class="display-4">Label Images</h1>
<hr>
<div class="card">
    <div class="card-header" id="headingOne">
      <h5 class="mb-0">
        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
          Unlabelled Images
        </button>
      </h5>
    </div>
  <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#imagePreview">
    <div class="card-body">
        <div class="card-body">
          {% if filenames %}
            {% for filename in filenames %}
            <img width="19%" src="{{upload_dir}}/{{filename}}" alt="{{filename}}" onclick="reset_canvas('{{upload_dir}}/{{filename}}');" data-toggle="collapse" data-target="#collapseOne"/>
            {% endfor %}
            <br>
          {% else %}
            No images to label
          {% endif %}
        </div>
      </div>
  </div>
</div>

<br>
<div class="modal fade" id="uploadHelp" tabindex="-1" role="dialog" aria-labelledby="uploadHelp" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Uploading Label Data</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>If you already have labelled data we support uploading a JSON file containing the labels.</p>

        <p>You should upload one file per image</p>

        The JSON data should match the following format:

        <pre><code>
          [
            <var>filename</var>,
            [
              [<var>px1</var>, <var>py1</var>, <var>px2</var>, <var>py2</var>, <var>label</var>],
              ...
            ]
          ]
        </code></pre>

        Where:
        <ul>
        <li><var>filename</var> is the name of the image file this applies to.<br>NOTE: If multiple images had the same name json files </li>
        <li><var>px1</var>, <var>py1</var>, <var>px2</var>, <var>py2</var> are the coordinates of each bounding box supplied as a fraction of image width/height (between 0-1)</li>
        <li><var>label</var> is the label that applies to that bounding box</li>
        <ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<div class="card">
  <h5 class="card-header">Label Image:</h5>
  <div class="card-body">
      <form action="/submit_label_file" enctype=multipart/form-data method="post">
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="">Upload labels</span>
        </div>
        <div class="custom-file">
          <input type="file" class="custom-file-input" name="uploaded-file" id="jsonUpload">
          <label class="custom-file-label" for="jsonUpload">Choose file</label>
        </div>
        <div class="input-group-append">
          <button class="btn btn-outline-success" type="submit">Upload</button>
          <button class="btn btn-outline-info" type="button" data-toggle="modal" data-target="#uploadHelp">ðŸ›ˆ</button>
        </div>
      </div>
      </form>
        <div class="btn-toolbar justify-content-between" role="toolbar" aria-label="Toolbar with button groups">
          <div class="btn-group" role="group" aria-label="First group">
                  <select id="labelSelection">
                  {% for label in labels %}
                      <option value="{{label|e}}">{{label|e}}</option>
                  {% endfor %}
                  </select>
                  <input placeholder="Enter Label Name..." id="label_name">
                  <div class="input-group-append">
                    <button onclick="create_label();" type="submit" class="btn btn-outline-success">Create Label</button>
                  </div>
          </div>
          <div class="btn-group" role="group" aria-label="Second group">
              <button onclick="save_labels();" class="btn btn-outline-success">Save Labels</button>
              <button onclick="undo();" class="btn btn-outline-danger">Undo</button>
          </div>
        </div>
      <canvas id="drawingCanvas" style="border:2px solid #f2f2f2;"></canvas>
  </div>
  </div>
  <hr>
</div>

<script type=text/javascript src="{{url_for('static', filename='scripts/label-image.js')}}"></script>
{% endblock %}
